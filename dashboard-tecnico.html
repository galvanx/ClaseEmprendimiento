<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Técnico | NexTherm</title>
  <link rel="icon" type="image/png" href="assets/L1.png">
  <link rel="stylesheet" href="css/styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header class="site-header">
    <a href="index.html" class="site-logo">
      <img src="assets/logonext.png" alt="NextTherm Thermal Recovery" width="160" height="56" loading="eager">
    </a>
    <input type="checkbox" id="nav-toggle" class="nav-toggle" aria-hidden="true">
    <label for="nav-toggle" class="nav-toggle-label" aria-label="Abrir menú">
      <span></span><span></span><span></span>
    </label>
    <nav class="main-nav">
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="dashboard-tecnico.html">Dashboard Técnico</a></li>
        <li><a href="dashboard-ejecutivo.html">Dashboard Ejecutivo</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div class="dashboard-header">
      <h1>Dashboard Técnico</h1>
      <p>Ingenieros / Operadores – Desempeño del sistema, eficiencia térmica y disponibilidad.</p>
    </div>

    <!-- 1. KPIs -->
    <section>
      <h2>KPIs principales</h2>
      <div class="kpi-grid">
        <div class="kpi-card">
          <div class="value">127</div>
          <div>kW térmicos recuperados</div>
          <div class="chart-container chart-container--kpi-lg" style="height: 95px; margin-top: 0.5rem;">
            <canvas id="gauge-kw-termicos"></canvas>
          </div>
        </div>
        <div class="kpi-card">
          <div class="value">63</div>
          <div>kW frío producido</div>
          <div class="chart-container chart-container--kpi-lg" style="height: 95px; margin-top: 0.5rem;">
            <canvas id="gauge-kw-frio"></canvas>
          </div>
        </div>
        <div class="kpi-card">
          <div class="value">0.49</div>
          <div>COP térmico real</div>
          <div class="chart-container" style="height: 70px; margin-top: 0.5rem;">
            <canvas id="gauge-cop"></canvas>
          </div>
        </div>
        <div class="kpi-card">
          <div class="value">94%</div>
          <div>Disponibilidad</div>
          <div class="chart-container" style="height: 70px; margin-top: 0.5rem;">
            <canvas id="donut-disponibilidad"></canvas>
          </div>
        </div>
        <div class="kpi-card">
          <div class="value">8.2 °C</div>
          <div>ΔT intercambiador</div>
        </div>
      </div>
    </section>

    <!-- 2. Energía recuperada vs diseño -->
    <section class="chart-wrapper">
      <h2>Energía recuperada vs diseño</h2>
      <div class="chart-container">
        <canvas id="chart-energia-vs-diseno"></canvas>
      </div>
    </section>

    <!-- 3. Balance energético (Sankey aproximado con barras) -->
    <section class="chart-wrapper">
      <h2>Balance energético</h2>
      <div class="chart-container">
        <canvas id="chart-balance"></canvas>
      </div>
    </section>

    <!-- 4. Circuito hidráulico -->
    <section class="chart-wrapper">
      <h2>Circuito hidráulico</h2>
      <div class="chart-container">
        <canvas id="chart-hidraulico"></canvas>
      </div>
    </section>

    <!-- 5. Producción de frío vs demanda -->
    <section class="chart-wrapper">
      <h2>Producción de frío vs demanda</h2>
      <div class="chart-container">
        <canvas id="chart-frio-demanda"></canvas>
      </div>
    </section>

    <!-- 6. Alarmas y estado -->
    <section>
      <h2>Alarmas y estado del sistema</h2>
      <div class="status-matrix">
        <div class="status-item status-ok">
          <strong>Vacío</strong><br>Correcto
        </div>
        <div class="status-item status-ok">
          <strong>Nivel buffer</strong><br>OK
        </div>
        <div class="status-item status-ok">
          <strong>Bomba 1</strong><br>100%
        </div>
        <div class="status-item status-ok">
          <strong>Bomba 2</strong><br>Standby
        </div>
        <div class="status-item status-ok">
          <strong>Vibración</strong><br>Normal
        </div>
      </div>
    </section>

    <!-- 7. Degradación del COP -->
    <section class="chart-wrapper">
      <h2>Degradación del COP (mensual)</h2>
      <div class="chart-container">
        <canvas id="chart-cop-mensual"></canvas>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p><strong>Equipo:</strong> Estefanía Rico, Luisa Contreras, Daphne Juarez, Jorge Galván, Valeria Sada Bello, Crisia Pineda. Emprendimiento Tecnológico – Campus Monterrey.</p>
  </footer>

  <script>
    (function() {
      var orange = '#FF5B04';
      var teal = '#075056';
      var dark = '#16232A';
      var gray = '#ebebeb';

      // Gauges: semicircle (color param) o donut completo para COP
      function gaugeChart(id, value, max, color) {
        var pct = Math.min(value / max, 1);
        var ctx = document.getElementById(id);
        if (!ctx) return;
        new Chart(ctx, {
          type: 'doughnut',
          data: {
            datasets: [{
              data: [pct * 100, 100 - pct * 100],
              backgroundColor: [color, gray],
              borderWidth: 0
            }]
          },
          options: {
            circumference: 180,
            rotation: 270,
            cutout: '75%',
            responsive: true,
            maintainAspectRatio: true,
            plugins: { legend: { display: false } }
          }
        });
      }
      gaugeChart('gauge-kw-termicos', 127, 200, orange);
      gaugeChart('gauge-kw-frio', 63, 100, teal);
      // COP: donut completo (360°) para que se distinga
      (function() {
        var copCtx = document.getElementById('gauge-cop');
        if (!copCtx) return;
        var copPct = Math.min(0.49 / 0.7, 1);
        new Chart(copCtx, {
          type: 'doughnut',
          data: {
            datasets: [{
              data: [copPct * 100, 100 - copPct * 100],
              backgroundColor: [orange, gray],
              borderWidth: 0
            }]
          },
          options: {
            circumference: 360,
            rotation: 270,
            cutout: '65%',
            responsive: true,
            maintainAspectRatio: true,
            plugins: { legend: { display: false } }
          }
        });
      })();

      // Donut disponibilidad
      var donutCtx = document.getElementById('donut-disponibilidad');
      if (donutCtx) {
        new Chart(donutCtx, {
          type: 'doughnut',
          data: {
            labels: ['Operando', 'Paro'],
            datasets: [{
              data: [94, 6],
              backgroundColor: [teal, gray],
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: { legend: { display: false } }
          }
        });
      }

      // Energía recuperada vs diseño (líneas)
      var energiaCtx = document.getElementById('chart-energia-vs-diseno');
      if (energiaCtx) {
        new Chart(energiaCtx, {
          type: 'line',
          data: {
            labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
            datasets: [
              { label: 'Energía térmica recuperada (kWh)', data: [4200, 4350, 4100, 4400, 4380, 3900, 4050], borderColor: orange, backgroundColor: 'transparent', fill: false, tension: 0.3 },
              { label: 'Objetivo diseño (kWh)', data: [4500, 4500, 4500, 4500, 4500, 4500, 4500], borderColor: teal, borderDash: [5, 5], backgroundColor: 'transparent', fill: false, tension: 0 }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: { y: { beginAtZero: true } }
          }
        });
      }

      // Balance energético (barras horizontales como aproximación Sankey)
      var balanceCtx = document.getElementById('chart-balance');
      if (balanceCtx) {
        new Chart(balanceCtx, {
          type: 'bar',
          data: {
            labels: ['Entrada disponible', 'Recuperado', 'No recuperable', 'Frío generado', 'Pérdidas'],
            datasets: [{
              label: 'GWh/planta',
              data: [4.74, 2.1, 1.8, 1.05, 0.79],
              backgroundColor: [teal, orange, dark, '#22c55e', '#94a3b8']
            }]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { beginAtZero: true } }
          }
        });
      }

      // Circuito hidráulico (multi-línea)
      var hidrCtx = document.getElementById('chart-hidraulico');
      if (hidrCtx) {
        new Chart(hidrCtx, {
          type: 'line',
          data: {
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
            datasets: [
              { label: 'T entrada (°C)', data: [82, 81, 85, 84, 83, 82], borderColor: orange, backgroundColor: 'transparent', fill: false, tension: 0.3 },
              { label: 'T salida (°C)', data: [72, 71, 74, 73, 72, 71], borderColor: teal, backgroundColor: 'transparent', fill: false, tension: 0.3 },
              { label: 'Flujo (m³/h)', data: [12, 11.5, 13, 12.5, 12, 11.8], borderColor: dark, backgroundColor: 'transparent', fill: false, tension: 0.3, yAxisID: 'y1' }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: {
              y: { type: 'linear', position: 'left', beginAtZero: false },
              y1: { type: 'linear', position: 'right', beginAtZero: true, grid: { drawOnChartArea: false } }
            }
          }
        });
      }

      // Producción frío vs demanda (barras + líneas)
      var frioCtx = document.getElementById('chart-frio-demanda');
      if (frioCtx) {
        new Chart(frioCtx, {
          type: 'bar',
          data: {
            labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
            datasets: [
              { label: 'Demanda enfriamiento (kW)', data: [70, 72, 68, 75, 74, 65, 68], backgroundColor: gray, yAxisID: 'y' },
              { label: 'Producción adsorción (kW)', data: [62, 63, 60, 64, 63, 58, 61], borderColor: orange, backgroundColor: 'transparent', type: 'line', fill: false, tension: 0.3, yAxisID: 'y' },
              { label: 'Respaldo eléctrico (kW)', data: [8, 9, 8, 11, 11, 7, 7], borderColor: dark, borderDash: [5, 5], backgroundColor: 'transparent', type: 'line', fill: false, tension: 0.3, yAxisID: 'y' }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'top' } },
            scales: { y: { beginAtZero: true } }
          }
        });
      }

      // Degradación COP mensual
      var copCtx = document.getElementById('chart-cop-mensual');
      if (copCtx) {
        new Chart(copCtx, {
          type: 'line',
          data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            datasets: [{
              label: 'COP mensual',
              data: [0.52, 0.51, 0.50, 0.50, 0.49, 0.49, 0.48, 0.49, 0.49, 0.48, 0.49, 0.49],
              borderColor: orange,
              backgroundColor: 'rgba(255, 91, 4, 0.1)',
              fill: true,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { min: 0.4, max: 0.6 },
              x: {}
            }
          }
        });
      }
    })();
  </script>
</body>
</html>
